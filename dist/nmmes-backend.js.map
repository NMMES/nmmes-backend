{"version":3,"sources":["webpack/universalModuleDefinition","webpack/bootstrap 86db108cf06d238d4a97","/home/ayrton/Documents/nmmes-backend/src/index.js","external \"chalk\"","/home/ayrton/Documents/nmmes-backend/src/logger.js","external \"tracer\"","/home/ayrton/Documents/nmmes-backend/src/module.js","/home/ayrton/Documents/nmmes-backend/src/video.js","external \"moment\"","external \"moment-duration-format\"","external \"filesize\"","external \"path\"","external \"bluebird\"","external \"lodash\"","external \"fs\"","external \"fluent-ffmpeg\""],"names":["process","on","reason","Logger","error","moduleRegex","options","format","dateformat","filters","trace","chalk","magenta","debug","blue","info","green","warn","yellow","red","preprocess","data","title","toUpperCase","matches","path","match","file","transport","stdout","write","output","logger","tracer","colorConsole","setLevel","level","MODULE_VERSION","Module","constructor","tolerance","displayName","name","Error","nmmes","moduleSysVersion","Object","assign","bold","attach","video","run","executable","TypeError","results","map","JSON","stringify","defaults","moduleClass","key","val","entries","default","require","once","promise","resolved","_self","apply","arguments","fs","Bluebird","promisifyAll","ffmpeg","Video","_initialize","metadata","ffprobeAsync","input","isNaN","duration","_calcDuration","streams","reduce","obj","stream","index","values","pos","vf","af","Path","basename","merge","strict","modules","parse","module","_initializeOutput","running","started","base","startTime","Date","moduleInitPromises","array","init","push","Promise","all","idx","e","stop","err","stopTime","message","moment","diff","trim","existsSync","stats","statAsync","outputSize","fileSize","size","reductionPercent","toFixed","resolve","reject","outputFormat","commandLine","stderr","lines","split","lastTime","length","RegExp","seconds"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;AC7DA;;AAEAA,QAAQC,EAAR,CAAW,oBAAX,EAAiC,UAASC,MAAT,EAAiB;AAC9CC,IAAA,2DAAAA,CAAOC,KAAP,CAAa,kBAAb,EAAiCF,MAAjC;AACH,CAFD;;AAIA;AACA;;;;;;;ACPA,kC;;;;;;;;;;;ACAA;AACA;;AAEA,MAAMG,cAAc,2BAApB;;AAEA,MAAMC,UAAU;AACZC,YAAQ,wEADI;AAEZC,gBAAY,YAFA;AAGZC,aAAS,CAAC;AACNC,eAAO,6CAAAC,CAAMC,OADP;AAENC,eAAO,6CAAAF,CAAMG,IAFP;AAGNC,cAAM,6CAAAJ,CAAMK,KAHN;AAINC,cAAM,6CAAAN,CAAMO,MAJN;AAKNd,eAAO,6CAAAO,CAAMQ;AALP,KAAD,CAHG;AAUZC,gBAAY,UAASC,IAAT,EAAe;AACvBA,aAAKC,KAAL,GAAaD,KAAKC,KAAL,CAAWC,WAAX,EAAb;AACA,cAAMC,UAAUH,KAAKI,IAAL,CAAUC,KAAV,CAAgBrB,WAAhB,CAAhB;AACAgB,aAAKM,IAAL,GAAYH,WAAWA,QAAQ,CAAR,CAAX,GAAyB,GAAEA,QAAQ,CAAR,CAAW,IAAGH,KAAKM,IAAK,EAAnD,GAAuDN,KAAKM,IAAxE;AACH,KAdW;AAeZC,eAAWP,QAAQ;AACfrB,gBAAQ6B,MAAR,CAAeC,KAAf,CAAqBT,KAAKU,MAAL,GAAc,IAAnC;AACH;AAjBW,CAAhB;;AAoBA,IAAIC,SAAS,8CAAAC,CAAOC,YAAP,CAAoB5B,OAApB,CAAb;AACA0B,OAAOG,QAAP,GAAmBC,KAAD,IAAW;AACzBJ,WAAOjB,IAAP,CAAa,wBAAuBqB,KAAM,GAA1C;AACAH,IAAA,8CAAAA,CAAOE,QAAP,CAAgBC,KAAhB;AACH,CAHD;AAIAJ,OAAOtB,KAAP,CAAa,qBAAb;AACA,yDAAesB,MAAf,E;;;;;;;;;;;;;AC/BA,mC;;;;;;;;;;ACAA;;;;AAEA;;AAIA,MAAMK,iBAAiB,CAAvB;;AAEA;;AAEe,MAAMC,MAAN,CAAa;AAGxBC,gBAAYxB,IAAZ,EAAkBT,UAAU,EAA5B,EAAgC;AAAA,aAFhCkC,SAEgC,GAFpB,UAEoB;;AAC5B,aAAKC,WAAL,GAAmB,KAAKF,WAAL,CAAiBG,IAApC;AACA,YAAI,OAAO3B,IAAP,KAAgB,WAApB,EAAiC;AAC7B,kBAAM,IAAI4B,KAAJ,CAAW,UAAS,KAAKF,WAAY,+BAArC,CAAN;AACH;;AAED,YAAI1B,KAAK6B,KAAL,IAAc7B,KAAK6B,KAAL,CAAWC,gBAAX,GAA8BR,cAAhD,EAAgE;AAC5DlC,YAAA,yCAAAA,CAAOc,IAAP,CAAa,UAAS,KAAKwB,WAAY,uBAAsB1B,KAAK6B,KAAL,CAAWC,gBAAiB,yCAAwCR,cAAe,IAAhJ;AACH;;AAED,aAAKtB,IAAL,GAAYA,IAAZ;AACA+B,eAAOC,MAAP,CAAc,IAAd,EAAoB;AAChBzC;AADgB,SAApB;;AAIAH,QAAA,yCAAAA,CAAOO,KAAP,CAAc,UAAS,6CAAAC,CAAMqC,IAAN,CAAW,KAAKP,WAAhB,CAA6B,iCAApD,EAAsFnC,OAAtF;AACH;;AAED2C,WAAOC,KAAP,EAAc;AACV,YAAI,KAAKA,KAAT,EACI,MAAM,IAAIP,KAAJ,CAAU,yBAAV,CAAN;;AAEJ,aAAKO,KAAL,GAAaA,KAAb;AACH;;AAEKC,OAAN,GAAY;AAAA;;AAAA;AACR,gBAAI,OAAO,MAAKC,UAAZ,KAA2B,UAA/B,EACI,MAAM,IAAIC,SAAJ,CAAe,UAAS,MAAKZ,WAAY,6CAAzC,CAAN;AACJ,gBAAIa,UAAU,MAAM,MAAKF,UAAL,CAAgBN,OAAOC,MAAP,CAAc,EAAd,EAAkB,MAAKG,KAAL,CAAWnB,MAAX,CAAkBwB,GAApC,CAAhB,CAApB;;AAEA,gBAAI,OAAOD,OAAP,KAAmB,WAAvB,EACI,yCAAAnD,CAAOc,IAAP,CAAa,UAAS,MAAKwB,WAAY,gCAAvC,EADJ,KAEK,IAAI,OAAOa,OAAP,KAAmB,QAAvB,EACD,MAAM,IAAID,SAAJ,CAAe,UAAS,MAAKZ,WAAY,gCAAzC,CAAN;;AAEJtC,YAAA,yCAAAA,CAAOO,KAAP,CAAc,UAAS,6CAAAC,CAAMqC,IAAN,CAAW,MAAKP,WAAhB,CAA6B,2BAApD,EAAgFe,KAAKC,SAAL,CAAeH,OAAf,CAAhF;;AAEA,mBAAOA,OAAP;AAZQ;AAaX;;AAED,WAAOI,QAAP,CAAgBC,WAAhB,EAA6B;AACzB,YAAID,WAAW,EAAf;AACA,aAAK,MAAM,CAACE,GAAD,EAAMC,GAAN,CAAX,IAAyBf,OAAOgB,OAAP,CAAeH,YAAYrD,OAAZ,EAAf,CAAzB,EAAgE;AAC5D,gBAAI,OAAOuD,IAAIE,OAAX,KAAuB,WAA3B,EACIL,SAASE,GAAT,IAAgBC,IAAIE,OAApB;AACP;AACD,eAAOL,QAAP;AACH;AAlDuB;AAAA;AAAA;AAAPpB,M,CAEVhC,O,GAAU,E;;;;;;;;;;;;;;;;;;;;ACZrB;;;;;;AAEA;;AAIA;AACA;AACA,mBAAA0D,CAAQ,CAAR;AACA;AACA;AACA;AACA;;AAIA,SAASC,IAAT,CAAcC,OAAd,EAAuB;AACnB,QAAIC,WAAW,KAAf;AAAA,QACIC,QAAQ,IADZ;AAEA,6BAAO,aAAiB;AACpB,YAAID,QAAJ,EACI,OAAOA,QAAP;;AAEJ,eAAOA,WAAWD,QAAQG,KAAR,CAAcD,KAAd,EAAqBE,SAArB,CAAlB;AACH,KALD;AAMH;;AAED,MAAMC,KAAK,gDAAAC,CAASC,YAAT,CAAsB,mBAAAT,CAAQ,EAAR,CAAtB,CAAX;AACA,MAAMU,SAAS,gDAAAF,CAASC,YAAT,CAAsB,mBAAAT,CAAQ,EAAR,CAAtB,CAAf;;AAEe,MAAMW,KAAN,CAAY;AACvBpC,gBAAYjC,OAAZ,EAAqB;AAAA;;AAAA,aA0DrBsE,WA1DqB,GA0DPX,uBAAK,aAAY;AAC3B9D,YAAA,yCAAAA,CAAOO,KAAP,CAAa,kCAAb;;AAEA,gBAAImE,WAAW,MAAMH,OAAOI,YAAP,CAAoB,MAAKC,KAAL,CAAWtD,IAA/B,CAArB;;AAEA,gBAAIuD,MAAMH,SAAStE,MAAT,CAAgB0E,QAAtB,CAAJ,EAAqC;;AAEjC9E,gBAAA,yCAAAA,CAAOO,KAAP,CAAa,mBAAb,EAAkC,6CAAAC,CAAMqC,IAAN,CAAW6B,SAAStE,MAAT,CAAgB0E,QAA3B,CAAlC;AACA9E,gBAAA,yCAAAA,CAAOU,KAAP,CAAc,uDAAd;;AAEA,oBAAIoE,WAAW,MAAMN,MAAMO,aAAN,CAAoB,MAAKH,KAAL,CAAWtD,IAA/B,CAArB;;AAEAtB,gBAAA,yCAAAA,CAAOU,KAAP,CAAc,0BAAyBoE,QAAS,aAAhD;AACAJ,yBAAStE,MAAT,CAAgB0E,QAAhB,GAA2BA,QAA3B;AACH;;AAED;AACAJ,qBAASM,OAAT,GAAmBN,SAASM,OAAT,CAAiBC,MAAjB,CAAwB,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACxDA,uBAAOP,KAAP,GAAe,CAAf;AACAM,oBAAIC,OAAOC,KAAX,IAAoBD,MAApB;AACA,uBAAOD,GAAP;AACH,aAJkB,EAIhB,EAJgB,CAAnB;;AAMA,kBAAKN,KAAL,CAAWF,QAAX,GAAsB;AAClB,mBAAGA;AADe,aAAtB;;AAIA,kBAAMM,UAAUrC,OAAO0C,MAAP,CAAcX,SAASM,OAAvB,CAAhB;AACA,iBAAK,IAAIM,GAAT,IAAgBN,OAAhB,EAAyB;AACrB,sBAAMG,SAASH,QAAQM,GAAR,CAAf;;AAEA,sBAAK1D,MAAL,CAAYwB,GAAZ,CAAgB4B,OAAhB,CAAwBG,OAAOC,KAA/B,IAAwC;AACpChC,yBAAM,GAAE+B,OAAOP,KAAM,IAAGO,OAAOC,KAAM,EADD;AAEpC,qBAAC,gBAAgBE,GAAjB,GAAuB,EAFa;AAGpC,qBAAC,iBAAiBA,GAAlB,GAAwB,EAHY;AAIpCC,wBAAI,EAJgC;AAKpCC,wBAAI;AALgC,iBAAxC;AAOH;;AAED;AACH,SAzCa,EA1DO;;AACjBxF,QAAA,yCAAAA,CAAOU,KAAP,CAAc,YAAW,6CAAAF,CAAMqC,IAAN,CAAW,4CAAA4C,CAAKC,QAAL,CAAcvF,QAAQyE,KAAR,CAActD,IAA5B,CAAX,CAA8C,GAAvE;;AAEA,YAAI,CAACnB,QAAQyE,KAAR,CAActD,IAAnB,EACI,MAAM,IAAIkB,KAAJ,CAAU,sCAAV,CAAN;AACJ,YAAI,CAACrC,QAAQyB,MAAR,CAAeN,IAApB,EACI,MAAM,IAAIkB,KAAJ,CAAU,uCAAV,CAAN;;AAEJmD,QAAA,qDAAAA,CAAM,IAAN,EAAY;AACRC,oBAAQ,IADA;AAERC,qBAAS,EAFD;AAGRjB,gCAAY,4CAAAa,CAAKK,KAAL,CAAW3F,QAAQyE,KAAR,CAActD,IAAzB,CAAZ;AACI8B,qBAAK;AACD4B,6BAAS,EADR;AAED5E,4BAAQ;AAFP;AADT,cAHQ;AASRwB,iCAAa,4CAAA6D,CAAKK,KAAL,CAAW3F,QAAQyB,MAAR,CAAeN,IAA1B,CAAb;AACI8B,qBAAK;AACD4B,6BAAS,EADR;AAED5E,4BAAQ;AAFP;AADT;AATQ,SAAZ,EAeGD,OAfH;;AAiBA,aAAK,IAAI4F,MAAT,IAAmB,KAAKF,OAAxB,EAAiC;AAC7BE,mBAAOjD,MAAP,CAAc,IAAd;AACH;;AAED9C,QAAA,yCAAAA,CAAOO,KAAP,CAAa,kBAAb,EAAiC,IAAjC;AACH;;AAEKyF,qBAAN,GAA0B;AAAA;;AAAA;AACtBhG,YAAA,yCAAAA,CAAOO,KAAP,CAAa,mCAAb;;AAEA,gBAAImE,WAAW,MAAMH,OAAOI,YAAP,CAAoB,OAAK/C,MAAL,CAAYN,IAAhC,CAArB;;AAEA,gBAAIuD,MAAMH,SAAStE,MAAT,CAAgB0E,QAAtB,CAAJ,EAAqC;;AAEjC9E,gBAAA,yCAAAA,CAAOO,KAAP,CAAa,mBAAb,EAAkC,6CAAAC,CAAMqC,IAAN,CAAW6B,SAAStE,MAAT,CAAgB0E,QAA3B,CAAlC;AACA9E,gBAAA,yCAAAA,CAAOU,KAAP,CAAc,uDAAd;;AAEA,oBAAIoE,WAAW,MAAMN,MAAMO,aAAN,CAAoB,OAAKnD,MAAL,CAAYN,IAAhC,CAArB;;AAEAtB,gBAAA,yCAAAA,CAAOU,KAAP,CAAc,0BAAyBoE,QAAS,aAAhD;AACAJ,yBAAStE,MAAT,CAAgB0E,QAAhB,GAA2BA,QAA3B;AACH;;AAED;AACAJ,qBAASM,OAAT,GAAmBN,SAASM,OAAT,CAAiBC,MAAjB,CAAwB,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACxDA,uBAAOP,KAAP,GAAe,CAAf;AACAM,oBAAIC,OAAOC,KAAX,IAAoBD,MAApB;AACA,uBAAOD,GAAP;AACH,aAJkB,EAIhB,EAJgB,CAAnB;;AAMA,mBAAKtD,MAAL,CAAY8C,QAAZ,GAAuBA,QAAvB;AAvBsB;AAwBzB;;AA6CK1B,OAAN,GAAY;AAAA;;AAAA;AACR,mBAAKiD,OAAL,GAAe,IAAf;AACA,mBAAKC,OAAL,GAAe,IAAf;AACAlG,YAAA,yCAAAA,CAAOY,IAAP,CAAa,sBAAqB,6CAAAJ,CAAMqC,IAAN,CAAW,OAAK+B,KAAL,CAAWuB,IAAtB,CAA4B,OAAM,6CAAA3F,CAAMqC,IAAN,CAAW,OAAKjB,MAAL,CAAYuE,IAAvB,CAA6B,GAAjG;AACA,mBAAKC,SAAL,GAAiB,IAAIC,IAAJ,EAAjB;;AAEA,kBAAM,OAAK5B,WAAL,EAAN;;AAEA,kBAAM6B,qBAAqB,OAAKT,OAAL,CAAaZ,MAAb,CAAoB,UAACsB,KAAD,EAAQR,MAAR,EAAmB;AAC9D,oBAAI,CAACA,OAAOS,IAAZ,EACI,OAAOD,KAAP;;AAEJA,sBAAME,IAAN,CAAWV,OAAOS,IAAP,EAAX;AACA,uBAAOD,KAAP;AACH,aAN0B,EAMxB,EANwB,CAA3B;;AAQA,kBAAMG,QAAQC,GAAR,CAAYL,kBAAZ,CAAN;;AAEA,gBAAI;AACA,qBAAK,MAAMM,GAAX,IAAkB,OAAKf,OAAvB,EAAgC;AAC5B,0BAAME,SAAS,OAAKF,OAAL,CAAae,GAAb,CAAf;AACA5G,oBAAA,yCAAAA,CAAOO,KAAP,CAAc,kBAAiB,6CAAAC,CAAMqC,IAAN,CAAWkD,OAAOzD,WAAlB,CAA+B,KAAI,6CAAA9B,CAAMqC,IAAN,CAAW+D,GAAX,CAAgB,IAAlF;;AAEA,wBAAIzD,UAAU,MAAM4C,OAAO/C,GAAP,CAAWL,OAAOC,MAAP,CAAc,EAAd,EAAkB,OAAKhB,MAAL,CAAYwB,GAA9B,CAAX,CAApB;AACAuC,oBAAA,qDAAAA,CAAM,OAAK/D,MAAL,CAAYwB,GAAlB,EAAuBD,OAAvB;AACH;AACJ,aARD,CAQE,OAAO0D,CAAP,EAAU;AACR,uBAAO,OAAKC,IAAL,CAAUD,CAAV,CAAP;AACH;;AAED,mBAAO,MAAM,OAAKC,IAAL,EAAb;AA9BQ;AA+BX;;AAEKA,QAAN,CAAWC,GAAX,EAAgB;AAAA;;AAAA;AACZ,mBAAKd,OAAL,GAAe,KAAf;AACA,mBAAKe,QAAL,GAAgB,IAAIX,IAAJ,EAAhB;;AAEA,gBAAIU,GAAJ,EAAS;AACL/G,gBAAA,yCAAAA,CAAOC,KAAP,CAAc,wCAAuC8G,IAAIE,OAAQ,EAAjE;AACAjH,gBAAA,yCAAAA,CAAOU,KAAP,CAAaqG,GAAb;AACA,uBAAK9G,KAAL,GAAa8G,GAAb;AACA,sBAAMA,GAAN;AACH;AACD,gBAAIjC,WAAW,8CAAAoC,CAAOpC,QAAP,CAAgB,8CAAAoC,CAAO,OAAKF,QAAZ,EAAsBG,IAAtB,CAA2B,OAAKf,SAAhC,CAAhB,EAA4D,cAA5D,EAA4EhG,MAA5E,CAAmF,aAAnF,EAAkG;AAC7GgH,sBAAM;AADuG,aAAlG,CAAf;;AAIA,gBAAI,CAAChD,GAAGiD,UAAH,CAAc,OAAKzF,MAAL,CAAYN,IAA1B,CAAL,EAAsC;AAClCtB,gBAAA,yCAAAA,CAAOc,IAAP,CAAY,oBAAZ;AACA;AACH;;AAEDd,YAAA,yCAAAA,CAAOU,KAAP,CAAc,kBAAiB,6CAAAF,CAAMqC,IAAN,CAAW,OAAKjB,MAAL,CAAYN,IAAvB,CAA6B,GAA5D;;AAEA,gBAAIgG,QAAQ,MAAMZ,QAAQC,GAAR,CAAY,CAACvC,GAAGmD,SAAH,CAAa,OAAK3C,KAAL,CAAWtD,IAAxB,CAAD,EAAgC8C,GAAGmD,SAAH,CAAa,OAAK3F,MAAL,CAAYN,IAAzB,CAAhC,CAAZ,CAAlB;;AAEA,gBAAIkG,aAAa,gDAAAC,CAASH,MAAM,CAAN,EAASI,IAAlB,CAAjB;AACA,gBAAIC,mBAAmB,CAACL,MAAM,CAAN,EAASI,IAAT,GAAgBJ,MAAM,CAAN,EAASI,IAAzB,GAAgC,GAAjC,EAAsCE,OAAtC,CAA8C,CAA9C,CAAvB;AACA5H,YAAA,yCAAAA,CAAOY,IAAP,CAAa,uBAAsB,6CAAAJ,CAAMqC,IAAN,CAAW,OAAK+B,KAAL,CAAWuB,IAAtB,CAA4B,KAAI,6CAAA3F,CAAMO,MAAN,CAAa+D,QAAb,CAAuB,MAAK,6CAAAtE,CAAMO,MAAN,CAAayG,UAAb,CAAyB,MAAK,6CAAAhH,CAAMO,MAAN,CAAa4G,mBAAiB,GAA9B,CAAmC,IAAhK;AAzBY;AA0Bf;;AAED,WAAO5C,aAAP,CAAqBH,KAArB,EAA4B;AACxB,eAAO,IAAI8B,OAAJ,CAAY,CAACmB,OAAD,EAAUC,MAAV,KAAqB;AACpCvD,mBAAOK,KAAP,EACKmD,YADL,CACkB,MADlB,EAEKnG,MAFL,CAEY,GAFZ,EAGK9B,EAHL,CAGQ,OAHR,EAGiB,UAASkI,WAAT,EAAsB;AAC/BhI,gBAAA,yCAAAA,CAAOO,KAAP,CAAa,iBAAb,EAAgCyH,WAAhC;AACH,aALL,EAMKlI,EANL,CAMQ,OANR,EAMiB,UAASiH,GAAT,EAAc;AACvBe,uBAAOf,GAAP;AACH,aARL,EASKjH,EATL,CASQ,KATR,EASe,UAAS4B,MAAT,EAAiBuG,MAAjB,EAAyB;AAChC,oBAAIC,QAAQD,OAAOE,KAAP,CAAa,IAAb,CAAZ;AACA,oBAAIC,WAAWF,MAAMA,MAAMG,MAAN,GAAe,CAArB,CAAf;AACA,oBAAIvD,WAAWsD,SAAS7G,KAAT,CAAe,IAAI+G,MAAJ,CAAW,+BAAX,CAAf,EAA4D,CAA5D,CAAf;AACA,oBAAIC,UAAU,8CAAArB,CAAOpC,QAAP,CAAgBA,QAAhB,EAA0B1E,MAA1B,CAAiC,GAAjC,EAAsC,CAAtC,CAAd;AACAJ,gBAAA,yCAAAA,CAAOO,KAAP,CAAc,mCAAkCgI,OAAQ,aAAxD;AACAV,wBAAQU,OAAR;AACH,aAhBL,EAgBOvF,GAhBP;AAiBH,SAlBM,CAAP;AAmBH;AAvLsB,C;;;;;;;;AC9B3B,mC;;;;;;ACAA,mD;;;;;;ACAA,qC;;;;;;ACAA,iC;;;;;;ACAA,qC;;;;;;ACAA,mC;;;;;;ACAA,+B;;;;;;ACAA,0C","file":"nmmes-backend.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"nmmes-backend\"] = factory();\n\telse\n\t\troot[\"nmmes-backend\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 86db108cf06d238d4a97","import Logger from './logger.js';\n\nprocess.on(\"unhandledRejection\", function(reason) {\n    Logger.error('UNHANDLED ERROR:', reason);\n});\n\nexport {default as Logger} from './logger';\nexport {default as Module} from './module';\nexport {default as Video} from './video';\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 1\n// module chunks = 0","import chalk from 'chalk';\nimport tracer from 'tracer';\n\nconst moduleRegex = /node_modules\\/(.*?(?=\\/))/;\n\nconst options = {\n    format: \"{{timestamp}} ({{method}}) [{{file}}:{{line}}] <{{title}}> {{message}}\",\n    dateformat: \"HH:MM:ss.L\",\n    filters: [{\n        trace: chalk.magenta,\n        debug: chalk.blue,\n        info: chalk.green,\n        warn: chalk.yellow,\n        error: chalk.red\n    }],\n    preprocess: function(data) {\n        data.title = data.title.toUpperCase();\n        const matches = data.path.match(moduleRegex);\n        data.file = matches && matches[1] ? `${matches[1]}>${data.file}` : data.file;\n    },\n    transport: data => {\n        process.stdout.write(data.output + \"\\n\");\n    }\n};\n\nlet logger = tracer.colorConsole(options);\nlogger.setLevel = (level) => {\n    logger.info(`Log level changed to ${level}.`)\n    tracer.setLevel(level);\n};\nlogger.trace('Logger initialized.');\nexport default logger;\n\n\n\n// WEBPACK FOOTER //\n// ./logger.js","module.exports = require(\"tracer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tracer\"\n// module id = 4\n// module chunks = 0","'use strict';\n\nimport {\n    Logger\n} from './';\n\nconst MODULE_VERSION = 1;\n\nimport chalk from 'chalk';\n\nexport default class Module {\n    tolerance = 'required';\n    static options = {};\n    constructor(info, options = {}) {\n        this.displayName = this.constructor.name;\n        if (typeof info === 'undefined') {\n            throw new Error(`Module ${this.displayName} must provide an info object.`);\n        }\n\n        if (info.nmmes && info.nmmes.moduleSysVersion < MODULE_VERSION) {\n            Logger.warn(`Module ${this.displayName}\\'s system version [${info.nmmes.moduleSysVersion}] is lower than the required version [${MODULE_VERSION}].`);\n        }\n\n        this.info = info;\n        Object.assign(this, {\n            options\n        });\n\n        Logger.trace(`Module ${chalk.bold(this.displayName)} has been created with options:`, options);\n    }\n\n    attach(video) {\n        if (this.video)\n            throw new Error('Video already attached.');\n\n        this.video = video;\n    }\n\n    async run() {\n        if (typeof this.executable !== 'function')\n            throw new TypeError(`Module ${this.displayName} must provide an executable class function.`);\n        let results = await this.executable(Object.assign({}, this.video.output.map));\n\n        if (typeof results === 'undefined')\n            Logger.warn(`Module ${this.displayName} returned an undefined result.`)\n        else if (typeof results !== 'object')\n            throw new TypeError(`Module ${this.displayName} returned a non object result.`);\n\n        Logger.trace(`Module ${chalk.bold(this.displayName)} has finished. Results:\\n`, JSON.stringify(results));\n\n        return results;\n    }\n\n    static defaults(moduleClass) {\n        let defaults = {};\n        for (const [key, val] of Object.entries(moduleClass.options())) {\n            if (typeof val.default !== 'undefined')\n                defaults[key] = val.default;\n        }\n        return defaults;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./module.js","'use strict';\n\nimport {\n    Logger\n} from './';\n\nimport chalk from 'chalk';\nimport moment from 'moment';\nrequire(\"moment-duration-format\");\nimport fileSize from 'filesize';\nimport Path from 'path';\nimport Bluebird from 'bluebird';\nimport {\n    merge\n} from 'lodash';\n\nfunction once(promise) {\n    let resolved = false,\n        _self = this;\n    return async function() {\n        if (resolved)\n            return resolved;\n\n        return resolved = promise.apply(_self, arguments);\n    }\n}\n\nconst fs = Bluebird.promisifyAll(require(\"fs\"));\nconst ffmpeg = Bluebird.promisifyAll(require(\"fluent-ffmpeg\"));\n\nexport default class Video {\n    constructor(options) {\n        Logger.debug(`Creating ${chalk.bold(Path.basename(options.input.path))}.`);\n\n        if (!options.input.path)\n            throw new Error('options.input.path must be provided.');\n        if (!options.output.path)\n            throw new Error('options.output.path must be provided.');\n\n        merge(this, {\n            strict: true,\n            modules: [],\n            input: { ...Path.parse(options.input.path),\n                map: {\n                    streams: {},\n                    format: {}\n                }\n            },\n            output: { ...Path.parse(options.output.path),\n                map: {\n                    streams: {},\n                    format: {}\n                }\n            }\n        }, options);\n\n        for (let module of this.modules) {\n            module.attach(this);\n        }\n\n        Logger.trace('Video created:\\n', this);\n    }\n\n    async _initializeOutput() {\n        Logger.trace('Generating metadata for output...');\n\n        let metadata = await ffmpeg.ffprobeAsync(this.output.path);\n\n        if (isNaN(metadata.format.duration)) {\n\n            Logger.trace('Invalid duration:', chalk.bold(metadata.format.duration));\n            Logger.debug(`Duration invalid, attempting to calculate manually...`);\n\n            let duration = await Video._calcDuration(this.output.path);\n\n            Logger.debug(`Duration calculated to ${duration} second(s).`);\n            metadata.format.duration = duration;\n        }\n\n        // Turn streams array into object indexed by stream index\n        metadata.streams = metadata.streams.reduce((obj, stream) => {\n            stream.input = 0;\n            obj[stream.index] = stream;\n            return obj;\n        }, {});\n\n        this.output.metadata = metadata;\n    }\n\n    _initialize = once(async () => {\n        Logger.trace('Generating metadata for input...');\n\n        let metadata = await ffmpeg.ffprobeAsync(this.input.path);\n\n        if (isNaN(metadata.format.duration)) {\n\n            Logger.trace('Invalid duration:', chalk.bold(metadata.format.duration));\n            Logger.debug(`Duration invalid, attempting to calculate manually...`);\n\n            let duration = await Video._calcDuration(this.input.path);\n\n            Logger.debug(`Duration calculated to ${duration} second(s).`);\n            metadata.format.duration = duration;\n        }\n\n        // Turn streams array into object indexed by stream index\n        metadata.streams = metadata.streams.reduce((obj, stream) => {\n            stream.input = 0;\n            obj[stream.index] = stream;\n            return obj;\n        }, {});\n\n        this.input.metadata = {\n            0: metadata\n        };\n\n        const streams = Object.values(metadata.streams);\n        for (let pos in streams) {\n            const stream = streams[pos];\n\n            this.output.map.streams[stream.index] = {\n                map: `${stream.input}:${stream.index}`,\n                ['metadata:s:' + pos]: [],\n                ['disposition:' + pos]: [],\n                vf: [],\n                af: []\n            };\n        }\n\n        return this;\n    });\n\n    async run() {\n        this.running = true;\n        this.started = true;\n        Logger.info(`Started processing ${chalk.bold(this.input.base)} -> ${chalk.bold(this.output.base)}.`);\n        this.startTime = new Date();\n\n        await this._initialize();\n\n        const moduleInitPromises = this.modules.reduce((array, module) => {\n            if (!module.init)\n                return array;\n\n            array.push(module.init());\n            return array;\n        }, []);\n\n        await Promise.all(moduleInitPromises);\n\n        try {\n            for (const idx in this.modules) {\n                const module = this.modules[idx];\n                Logger.trace(`Running module ${chalk.bold(module.displayName)} [${chalk.bold(idx)}].`);\n\n                let results = await module.run(Object.assign({}, this.output.map));\n                merge(this.output.map, results);\n            }\n        } catch (e) {\n            return this.stop(e);\n        }\n\n        return await this.stop();\n    }\n\n    async stop(err) {\n        this.running = false;\n        this.stopTime = new Date();\n\n        if (err) {\n            Logger.error(`Video stopped processing with error: ${err.message}`);\n            Logger.debug(err);\n            this.error = err;\n            throw err;\n        }\n        let duration = moment.duration(moment(this.stopTime).diff(this.startTime), 'milliseconds').format('h:mm:ss.SSS', {\n            trim: false\n        });\n\n        if (!fs.existsSync(this.output.path)) {\n            Logger.warn('No output created.');\n            return;\n        }\n\n        Logger.debug(`File output to ${chalk.bold(this.output.path)}.`);\n\n        let stats = await Promise.all([fs.statAsync(this.input.path), fs.statAsync(this.output.path)]);\n\n        let outputSize = fileSize(stats[1].size);\n        let reductionPercent = (stats[1].size / stats[0].size * 100).toFixed(2);\n        Logger.info(`Finished processing ${chalk.bold(this.input.base)} [${chalk.yellow(duration)}] [${chalk.yellow(outputSize)}] [${chalk.yellow(reductionPercent+'%')}].`);\n    }\n\n    static _calcDuration(input) {\n        return new Promise((resolve, reject) => {\n            ffmpeg(input)\n                .outputFormat('null')\n                .output('-')\n                .on('start', function(commandLine) {\n                    Logger.trace('[FFMPEG] Query:', commandLine);\n                })\n                .on('error', function(err) {\n                    reject(err);\n                })\n                .on('end', function(stdout, stderr) {\n                    let lines = stderr.split('\\n');\n                    let lastTime = lines[lines.length - 3];\n                    let duration = lastTime.match(new RegExp('time=(([0-9]|\\:|\\.)+) bitrate'))[1];\n                    let seconds = moment.duration(duration).format(\"s\", 6);\n                    Logger.trace(`Duration manually calculated to ${seconds} second(s).`);\n                    resolve(seconds);\n                }).run();\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./video.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"moment-duration-format\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment-duration-format\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"filesize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"filesize\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"fluent-ffmpeg\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fluent-ffmpeg\"\n// module id = 14\n// module chunks = 0"],"sourceRoot":""}