{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f38c13547a96dc465610","webpack:///./logger.js","webpack:///external \"bluebird\"","webpack:///external \"chalk\"","webpack:///./module.js","webpack:///external \"events\"","webpack:///./index.js","webpack:///./video.js","webpack:///../~/webpack/buildin/harmony-module.js","webpack:///external \"filesize\"","webpack:///external \"fluent-ffmpeg\"","webpack:///external \"fs\"","webpack:///external \"lodash\"","webpack:///external \"lodash/cloneDeep\"","webpack:///external \"lodash/merge\"","webpack:///external \"moment\"","webpack:///external \"moment-duration-format\"","webpack:///external \"npm-query\"","webpack:///external \"path\"","webpack:///external \"query-string\"","webpack:///external \"semver\"","webpack:///external \"tracer\""],"names":["options","format","trace","debug","filters","chalk","magenta","blue","info","green","warn","yellow","error","red","dateformat","preprocess","data","title","toUpperCase","transport","logger","stream","write","output","console","log","tracer","colorConsole","setLevel","level","Module","constructor","provides","tolerance","displayName","name","Error","Object","assign","Logger","bold","run","video","force","cache","_self","pending","moduleCache","createModuleQuery","resolve","module","execute","reject","Imap","strict","noStrict","deepFreeze","cloneDeep","map","emit","runModule","executable","then","result","JSON","stringify","merge","err","message","stopHandler","cancel","once","removeListener","queryString","args","obj","depth","propNames","getOwnPropertyNames","forEach","prop","freeze","checkForUpdates","modules","client","moduleMap","reduce","queries","Promise","getModule","reflect","props","results","entries","isFulfilled","value","latest","current","version","semver","gt","reason","config","warnings","longStackTraces","cancellation","monitoring","process","on","require","stat","promisify","fs","Video","Path","basename","input","path","curretModuleIndex","stop","_stop","parse","streams","initialized","ffmpeg","ffprobe","metadata","index","values","pos","isNaN","duration","calcDuration","start","base","startTime","Date","all","array","init","push","bind","return","number","stopTime","moduleName","moment","diff","trim","stats","outputSize","fileSize","size","bits","reductionPercent","toFixed","catch","outputFormat","commandLine","stdout","stderr","lines","split","lastTime","length","match","RegExp","seconds"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;AChEA;AACA;;AAEA,MAAMA,UAAU;AACZC,YAAQ,CACJ,yBADI,EAEJ;AACIC,eAAO,8DADX;AAEIC,eAAO;AAFX,KAFI,CADI;AAQZC,aAAS,CAAC;AACNF,eAAO,6CAAAG,CAAMC,OADP;AAENH,eAAO,6CAAAE,CAAME,IAFP;AAGNC,cAAM,6CAAAH,CAAMI,KAHN;AAINC,cAAM,6CAAAL,CAAMM,MAJN;AAKNC,eAAO,6CAAAP,CAAMQ;AALP,KAAD,CARG;AAeZC,gBAAY,YAfA;AAgBZC,gBAAY,UAASC,IAAT,EAAe;AACvBA,aAAKC,KAAL,GAAaD,KAAKC,KAAL,CAAWC,WAAX,EAAb;AACH,KAlBW;AAmBZC,eAAW,UAASH,IAAT,EAAe;AACtB,YAAII,OAAOC,MAAX,EAAmB;AACfD,mBAAOC,MAAP,CAAcC,KAAd,CAAoBN,KAAKO,MAAL,GAAc,IAAlC;AACH,SAFD,MAEO;AACHC,oBAAQC,GAAR,CAAYT,KAAKO,MAAjB;AACH;AACJ;AAzBW,CAAhB;;AA4BA,IAAIH,SAAS,8CAAAM,CAAOC,YAAP,CAAoB3B,OAApB,CAAb;AACAoB,OAAOQ,QAAP,GAAmBC,KAAD,IAAW;AACzBH,IAAA,8CAAAA,CAAOE,QAAP,CAAgBC,KAAhB;AACH,CAFD;AAGA,yDAAeT,MAAf,E;;;;;;ACnCA,qC;;;;;;ACAA,kC;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;AAIe,MAAMU,MAAN,SAAqB,oDAArB,CAAkC;AAG7CC,gBAAYvB,IAAZ,EAAkBR,UAAU,EAA5B,EAAgC;AAC5B;AAD4B,aAFhCgC,QAEgC,GAFrB,EAEqB;AAAA,aADhCC,SACgC,GADpB,UACoB;AAE5B,aAAKC,WAAL,GAAmB,KAAKH,WAAL,CAAiBI,IAApC;AACA,YAAI,OAAO3B,IAAP,KAAgB,WAApB,EAAiC;AAC7B,kBAAM,IAAI4B,KAAJ,CAAW,UAAS,KAAKF,WAAY,+BAArC,CAAN;AACH;AACD,aAAK1B,IAAL,GAAYA,IAAZ;AACA6B,eAAOC,MAAP,CAAc,IAAd,EAAoB;AAChBtC;AADgB,SAApB;;AAIAuC,QAAA,2DAAAA,CAAOrC,KAAP,CAAc,UAAS,6CAAAG,CAAMmC,IAAN,CAAW,KAAKN,WAAhB,CAA6B,iCAApD,EAAsFlC,OAAtF;AACH;AACDyC,QAAIC,KAAJ,EAAWC,QAAQ,KAAnB,EAA0BC,QAAQ,IAAlC,EAAwC;AACpC,YAAIC,QAAQ,IAAZ;AACA,YAAI,KAAKC,OAAT,EAAkB;AACd,mBAAO,KAAKA,OAAZ;AACH;AACD,YAAIJ,MAAMK,WAAN,CAAkBC,kBAAkB,IAAlB,CAAlB,KAA8CN,MAAMK,WAAN,CAAkBC,kBAAkB,IAAlB,CAAlB,EAA2CJ,KAAzF,IAAkG,CAACD,KAAvG,EAA8G;AAC1G,mBAAO,IAAI,gDAAJ,CAAaM,OAAD,IAAa;AAC5BV,gBAAA,2DAAAA,CAAOpC,KAAP,CAAc,qBAAoB,6CAAAE,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,gEAAhE;AACAe,wBAAQP,MAAMK,WAAN,CAAkBC,kBAAkB,IAAlB,CAAlB,EAA2CJ,KAAnD;AACH,aAHM,CAAP;AAIH;;AAEDF,cAAMK,WAAN,CAAkBC,kBAAkB,IAAlB,CAAlB,IAA6C,IAA7C;AACA,aAAK,IAAIb,IAAT,IAAiB,KAAKH,QAAtB,EAAgC;AAC5BU,kBAAMK,WAAN,CAAkBC,kBAAkBE,MAAlB,EAA0Bf,IAA1B,CAAlB,IAAqDe,MAArD;AACH;;AAED,eAAO,KAAKC,OAAL,CAAaT,KAAb,EAAoBE,KAApB,CAAP;AACH;AACDO,YAAQT,KAAR,EAAeE,KAAf,EAAsB;AAClB,YAAIC,QAAQ,IAAZ;AACA,eAAO,KAAKC,OAAL,GAAe,IAAI,gDAAJ,CAAY,CAACG,OAAD,EAAUG,MAAV,KAAqB;;AAEnD;AACA,kBAAMC,OAAOX,MAAMY,MAAN,IAAgB,CAACT,MAAM7C,OAAN,CAAcuD,QAA/B,GAA0CC,WAAW,wDAAAC,CAAUf,MAAMnB,MAAN,CAAamC,GAAvB,CAAX,CAA1C,GAAoFhB,MAAMnB,MAAN,CAAamC,GAA9G;;AAEAnB,YAAA,2DAAAA,CAAO/B,IAAP,CAAa,UAAS,6CAAAH,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,eAApD;;AAEAQ,kBAAMiB,IAAN,CAAW,cAAX,EAA2Bd,KAA3B;AACAA,kBAAMc,IAAN,CAAW,OAAX;;AAEA,gBAAIC,YAAYf,MAAMgB,UAAN,CAAiBnB,KAAjB,EAAwBW,IAAxB,CAAhB;;AAEAO,sBAAUE,IAAV,CAAe,CAACC,SAAS,EAAV,KAAiB;AAC5BrB,sBAAMiB,IAAN,CAAW,aAAX,EAA0Bd,KAA1B;AACAA,sBAAMc,IAAN,CAAW,MAAX;AACApB,gBAAA,2DAAAA,CAAOrC,KAAP,CAAc,UAAS,6CAAAG,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,2BAArD,EAAiF8B,KAAKC,SAAL,CAAeF,MAAf,CAAjF;;AAEArB,sBAAMnB,MAAN,CAAamC,GAAb,GAAmB,oDAAAQ,CAAMxB,MAAMnB,MAAN,CAAamC,GAAnB,EAAwBK,MAAxB,CAAnB;;AAEA,oBAAInB,KAAJ,EACIC,MAAMD,KAAN,GAAcmB,MAAd;AACJ,uBAAOlB,MAAMC,OAAb;AACAG,wBAAQc,MAAR;AACH,aAXD,EAWII,GAAD,IAAS;AACRzB,sBAAMiB,IAAN,CAAW,aAAX,EAA0Bd,KAA1B,EAAiCsB,GAAjC;AACAtB,sBAAMc,IAAN,CAAW,MAAX,EAAmBQ,GAAnB;AACAtB,sBAAMjC,KAAN,GAAcuD,GAAd;AACA,oBAAItB,MAAMZ,SAAN,KAAoB,UAAxB,EAAoC;AAChCM,oBAAA,2DAAAA,CAAO3B,KAAP,CAAc,mBAAkB,6CAAAP,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,YAAWiC,IAAIC,OAAQ,EAArF;AACA7B,oBAAA,2DAAAA,CAAOpC,KAAP,CAAc,UAAS,6CAAAE,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,SAArD,EAA+DiC,GAA/D;AACA,2BAAOf,OAAOe,GAAP,CAAP;AACH,iBAJD,MAIO,IAAItB,MAAMZ,SAAN,KAAoB,UAAxB,EAAoC;AACvCM,oBAAA,2DAAAA,CAAO7B,IAAP,CAAa,mBAAkB,6CAAAL,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,YAAWiC,IAAIC,OAAQ,EAApF;AACA7B,oBAAA,2DAAAA,CAAOpC,KAAP,CAAc,UAAS,6CAAAE,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,SAArD,EAA+DiC,GAA/D;AACA,2BAAOlB,SAAP;AACH,iBAJM,MAIA;AACHV,oBAAA,2DAAAA,CAAO3B,KAAP,CAAc,UAAS,6CAAAP,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,YAAWiC,IAAIC,OAAQ,EAA5E;AACA7B,oBAAA,2DAAAA,CAAOpC,KAAP,CAAc,UAAS,6CAAAE,CAAMmC,IAAN,CAAWK,MAAMX,WAAjB,CAA8B,SAArD,EAA+DiC,GAA/D;AACA,2BAAOf,OAAOe,GAAP,CAAP;AACH;AACJ,aA5BD;AA6BA,gBAAIE,cAAeF,GAAD,IAAS;AACvBtB,sBAAMc,IAAN,CAAW,MAAX,EAAmBQ,GAAnB;AACAP,0BAAUU,MAAV;AACH,aAHD;AAIA5B,kBAAM6B,IAAN,CAAW,MAAX,EAAmBF,WAAnB;AACAxB,kBAAM0B,IAAN,CAAW,MAAX,EAAmB,MAAM;AACrB7B,sBAAM8B,cAAN,CAAqB,MAArB,EAA6BH,WAA7B;AACH,aAFD;AAGH,SAjDqB,CAAtB;AAkDH;AAvF4C;AAAA;AAAA;;AA0FjD,SAASrB,iBAAT,CAA2BE,MAA3B,EAAmCf,IAAnC,EAAyC;AACrC,WAAOA,QAAQe,OAAOhB,WAAP,GAAqB,GAArB,GAA2B,oDAAAuC,CAAYR,SAAZ,CAAsBf,OAAOwB,IAA7B,CAA1C;AACH;;AAED,SAASlB,UAAT,CAAoBmB,GAApB,EAAyBC,QAAQ,CAAjC,EAAoC;;AAEhC;AACA,QAAIC,YAAYxC,OAAOyC,mBAAP,CAA2BH,GAA3B,CAAhB;;AAEA;AACAE,cAAUE,OAAV,CAAkB,UAAS5C,IAAT,EAAe;AAC7B,YAAI6C,OAAOL,IAAIxC,IAAJ,CAAX;;AAEA;AACA,YAAI,OAAO6C,IAAP,IAAe,QAAf,IAA2BA,SAAS,IAApC,IAA4CJ,QAAQ,CAAxD,EACIpB,WAAWwB,IAAX,EAAiB,EAAEJ,KAAnB;AACP,KAND;;AAQA;AACA,WAAOvC,OAAO4C,MAAP,CAAcN,GAAd,CAAP;AACH;;AAEM,SAASO,eAAT,CAAyBC,OAAzB,EAAkC;AACrC,QAAIC,SAAS,IAAI,oDAAJ,EAAb;;AAEA;AACA,QAAIC,YAAYF,QAAQG,MAAR,CAAe,CAACX,GAAD,EAAMzB,MAAN,KAAiB;AAC5CyB,YAAIzB,OAAO1C,IAAP,CAAY2B,IAAhB,IAAwBe,MAAxB;AACA,eAAOyB,GAAP;AACH,KAHe,EAGb,EAHa,CAAhB;;AAKA,QAAIY,UAAUJ,QAAQG,MAAR,CAAe,CAACX,GAAD,EAAMzB,MAAN,KAAiB;AAC1CyB,YAAIzB,OAAO1C,IAAP,CAAY2B,IAAhB,IAAwB,gDAAAqD,CAAQvC,OAAR,CAAgBmC,OAAOK,SAAP,CAAiBvC,OAAO1C,IAAP,CAAY2B,IAA7B,CAAhB,EAAoDuD,OAApD,EAAxB;AACA,eAAOf,GAAP;AACH,KAHa,EAGX,EAHW,CAAd;;AAKAa,IAAA,gDAAAA,CAAQG,KAAR,CAAcJ,OAAd,EAAuBzB,IAAvB,CAA6B8B,OAAD,IAAa;AACrC,aAAK,IAAI,CAACzD,IAAD,EAAOnB,IAAP,CAAT,IAAyBqB,OAAOwD,OAAP,CAAeD,OAAf,CAAzB,EAAkD;AAC9C,gBAAI5E,KAAK8E,WAAL,EAAJ,EAAwB;AACpB9E,uBAAOA,KAAK+E,KAAL,EAAP;AACA,sBAAMC,SAAShF,KAAK,WAAL,EAAkBgF,MAAjC;AACA,sBAAMC,UAAUZ,UAAUlD,IAAV,EAAgB3B,IAAhB,CAAqB0F,OAArC;AACA,oBAAI,8CAAAC,CAAOC,EAAP,CAAUJ,MAAV,EAAkBC,OAAlB,CAAJ,EAAgC;AAC5B1D,oBAAA,2DAAAA,CAAO7B,IAAP,CAAa,oBAAmByB,IAAK,IAAG6D,MAAO,wBAAuBC,OAAQ,GAA9E;AACH;AACJ,aAPD,MAOO;AACHjF,uBAAOA,KAAKqF,MAAL,EAAP;AACA9D,gBAAA,2DAAAA,CAAOrC,KAAP,CAAc,wCAAuC,6CAAAG,CAAMmC,IAAN,CAAWL,IAAX,CAAiB,UAAtE,EAAiFnB,KAAKoD,OAAtF;AACH;AACJ;AACJ,KAdD;AAeH,C;;;;;;;AC7JD,mC;;;;;;;;;;;;;;;;ACAA;AACA;AACA,gDAAAoB,CAAQc,MAAR,CAAe;AACX;AACAC,cAAU,IAFC;AAGX;AACAC,qBAAiB,IAJN;AAKX;AACAC,kBAAc,IANH;AAOX;AACAC,gBAAY;AARD,CAAf;;AAWAC,QAAQC,EAAR,CAAW,oBAAX,EAAiC,UAASP,MAAT,EAAiB;AAC9C9D,IAAA,2DAAAA,CAAO3B,KAAP,CAAa,kBAAb,EAAiCyF,MAAjC;AACH,CAFD;;AAIA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBA;;;;AAEA;AACA;AACA;AACA;AACA,mBAAAQ,CAAQ,EAAR;AACA;AACA;AACA;AACA;AAGA;AAGA;;AAEA,MAAMC,OAAO,gDAAAtB,CAAQuB,SAAR,CAAkB,0CAAAC,CAAGF,IAArB,CAAb;;AAEA;;AAEe,MAAMG,KAAN,SAAoB,8CAApB,CAAiC;AAG5ClF,gBAAY/B,OAAZ,EAAqB;AACjBuC,QAAA,4DAAAA,CAAOpC,KAAP,CAAc,YAAW,6CAAAE,CAAMmC,IAAN,CAAW,4CAAA0E,CAAKC,QAAL,CAAcnH,QAAQoH,KAAR,CAAcC,IAA5B,CAAX,CAA8C,GAAvE;;AAEA,YAAI,CAACrH,QAAQoH,KAAR,CAAcC,IAAnB,EACI,MAAM,IAAIjF,KAAJ,CAAU,sCAAV,CAAN;AACJ,YAAI,CAACpC,QAAQuB,MAAR,CAAe8F,IAApB,EACI,MAAM,IAAIjF,KAAJ,CAAU,uCAAV,CAAN;;AAEJ;;AARiB,aAFrBkF,iBAEqB,GAFD,CAEC;AAAA,aADrBvE,WACqB,GADP,EACO;AAAA,aAiKrBwE,IAjKqB,GAiKd,KAAKC,KAjKS;AAUjBtD,QAAA,oEAAAA,CAAM,IAAN,EAAY;AACRZ,oBAAQ,IADA;AAER8D,gCAAY,4CAAAF,CAAKO,KAAL,CAAWzH,QAAQoH,KAAR,CAAcC,IAAzB,CAAZ;AACI3D,qBAAK;AACDgE,6BAAS,EADR;AAEDzH,4BAAQ;AAFP;AADT,cAFQ;AAQRsB,iCAAa,4CAAA2F,CAAKO,KAAL,CAAWzH,QAAQuB,MAAR,CAAe8F,IAA1B,CAAb;AACI3D,qBAAK;AACDgE,6BAAS,EADR;AAEDzH,4BAAQ;AAFP;AADT;AARQ,SAAZ,EAcGD,OAdH;;AAgBA;;AAEAuC,QAAA,4DAAAA,CAAOrC,KAAP,CAAa,kBAAb,EAAiC,IAAjC;AACH;AACDyH,kBAAc;AACV,YAAI9E,QAAQ,IAAZ;AACA,eAAO,IAAI,gDAAJ,CAAY,CAACI,OAAD,EAAUG,MAAV,KAAqB;AACpCb,YAAA,4DAAAA,CAAOrC,KAAP,CAAa,kCAAb;AACA0H,YAAA,qDAAAA,CAAOC,OAAP,CAAehF,MAAMuE,KAAN,CAAYC,IAA3B,EAAiC,UAASlD,GAAT,EAAc2D,QAAd,EAAwB;AACrD,oBAAI3D,GAAJ,EACI,OAAOf,OAAOe,GAAP,CAAP;;AAEJ;AACA;AACA2D,yBAASJ,OAAT,GAAmBI,SAASJ,OAAT,CAAiBpC,MAAjB,CAAwB,CAACX,GAAD,EAAMtD,MAAN,KAAiB;AACxDA,2BAAO+F,KAAP,GAAe,CAAf;AACAzC,wBAAItD,OAAO0G,KAAX,IAAoB1G,MAApB;AACA,2BAAOsD,GAAP;AACH,iBAJkB,EAIhB,EAJgB,CAAnB;;AAMA9B,sBAAMuE,KAAN,CAAYU,QAAZ,GAAuB;AACnB,uBAAGA;AADgB,iBAAvB;;AAIA,sBAAMJ,UAAUrF,OAAO2F,MAAP,CAAcF,SAASJ,OAAvB,CAAhB;AACA,qBAAK,IAAIO,GAAT,IAAgBP,OAAhB,EAAyB;AACrB,0BAAMrG,SAASqG,QAAQO,GAAR,CAAf;;AAEApF,0BAAMtB,MAAN,CAAamC,GAAb,CAAiBgE,OAAjB,CAAyBrG,OAAO0G,KAAhC,IAAyC;AACrCrE,6BAAM,GAAErC,OAAO+F,KAAM,IAAG/F,OAAO0G,KAAM,EADA;AAErC,yBAAC,gBAAgBE,GAAjB,GAAuB,EAFc;AAGrC,yBAAC,iBAAiBA,GAAlB,GAAwB;AAHa,qBAAzC;AAKH;;AAED,oBAAIC,MAAMJ,SAAS7H,MAAT,CAAgBkI,QAAtB,CAAJ,EAAqC;AACjC5F,oBAAA,4DAAAA,CAAOrC,KAAP,CAAa,mBAAb,EAAkC,6CAAAG,CAAMmC,IAAN,CAAWsF,SAAS7H,MAAT,CAAgBkI,QAA3B,CAAlC;AACA5F,oBAAA,4DAAAA,CAAOpC,KAAP,CAAc,uDAAd;AACAiI,iCAAavF,MAAMuE,KAAN,CAAYC,IAAzB,EAA+BvD,IAA/B,CAAqCqE,QAAD,IAAc;AAC9C5F,wBAAA,4DAAAA,CAAOpC,KAAP,CAAc,0BAAyBgI,QAAS,aAAhD;AACAL,iCAAS7H,MAAT,CAAgBkI,QAAhB,GAA2BA,QAA3B;AACAlF;AACH,qBAJD,EAIGG,MAJH;AAKH,iBARD,MAQO;AACHH;AACH;AACJ,aAtCD;AAuCH,SAzCM,CAAP;AA0CH;;AAEDoF,YAAQ;AACJ,YAAIxF,QAAQ,IAAZ;AACA,aAAKc,IAAL,CAAU,OAAV;AACApB,QAAA,4DAAAA,CAAO/B,IAAP,CAAa,sBAAqB,6CAAAH,CAAMmC,IAAN,CAAW,KAAK4E,KAAL,CAAWkB,IAAtB,CAA4B,GAA9D;AACA,aAAKC,SAAL,GAAiB,IAAIC,IAAJ,EAAjB;;AAEA,eAAO,IAAI,gDAAJ,CAAY,CAACvF,OAAD,EAAUG,MAAV,KAAqB;AACpC;AACAoC,YAAA,gDAAAA,CACKiD,GADL,CACS,KAAKtD,OAAL,CAAaG,MAAb,CAAoB,CAACoD,KAAD,EAAQxF,MAAR,KAAmB;AACxC,oBAAI,CAACA,OAAOyF,IAAZ,EACI,OAAOD,KAAP;AACJA,sBAAME,IAAN,CAAW,IAAI,gDAAJ,CAAY,CAAC3F,OAAD,EAAUG,MAAV,KAAqB;AACxCF,2BAAOyF,IAAP,CAAY9F,KAAZ,EAAmBiB,IAAnB,CAAwBb,OAAxB,EAAkCkB,GAAD,IAAS;AACtC5B,wBAAA,4DAAAA,CAAO3B,KAAP,CAAc,UAAS,6CAAAP,CAAMmC,IAAN,CAAWU,OAAOhB,WAAlB,CAA+B,2BAA0BiC,IAAIC,OAAQ,EAA5F;AACA7B,wBAAA,4DAAAA,CAAOpC,KAAP,CAAa,QAAb,EAAuBgE,GAAvB;AACAf,+BAAO,IAAIhB,KAAJ,CAAU,+BAAV,CAAP;AACH,qBAJD;AAKH,iBANU,CAAX;AAOA,uBAAOsG,KAAP;AACH,aAXI,EAWF,EAXE,CADT,EAaK5E,IAbL,CAaU,KAAK6D,WAAL,CAAiBkB,IAAjB,CAAsB,IAAtB,CAbV,EAcK/E,IAdL,CAcUb,OAdV,EAeK6F,MAfL,CAeY,CAfZ,EAgBKhF,IAhBL,CAgBU,KAAKF,SAAL,CAAeiF,IAAf,CAAoB,IAApB,CAhBV,EAgBsC1E,GAAD,IAAS;AACtC,qBAAKqD,KAAL,CAAWrD,GAAX;AACAf,uBAAOe,GAAP;AACH,aAnBL;AAoBH,SAtBM,CAAP;AAuBH;;AAEDP,cAAUmF,SAAS,KAAKzB,iBAAxB,EAA2C;AACvC,YAAI,CAAC,KAAKnC,OAAL,CAAa4D,MAAb,CAAL,EAA2B;AACvB,iBAAKvB,KAAL;AACA;AACH;AACD,YAAI,KAAKwB,QAAT,EACI;AACJ,cAAMC,aAAa,KAAK9D,OAAL,CAAa4D,MAAb,EAAqB7G,WAAxC;AACAK,QAAA,4DAAAA,CAAOrC,KAAP,CAAc,kBAAiB,6CAAAG,CAAMmC,IAAN,CAAWyG,UAAX,CAAuB,KAAI,6CAAA5I,CAAMmC,IAAN,CAAWuG,MAAX,CAAmB,IAA7E;AACA,aAAK5D,OAAL,CAAa4D,MAAb,EAAqBtG,GAArB,CAAyB,IAAzB,EAA+BqB,IAA/B,CAAoC,MAAM;AACtC,iBAAKF,SAAL,CAAe,EAAEmF,MAAjB;AACH,SAFD,EAEI5E,GAAD,IAAS;AACR,gBAAI,KAAKgB,OAAL,CAAa4D,MAAb,EAAqB9G,SAArB,KAAmC,UAAvC,EAAmD;AAC/CM,gBAAA,4DAAAA,CAAOpC,KAAP,CAAa,QAAb,EAAuBgE,GAAvB;AACA,uBAAO,KAAKqD,KAAL,CAAW,IAAIpF,KAAJ,CAAU,0BAAV,CAAX,CAAP;AACH;;AAED,iBAAKwB,SAAL,CAAe,EAAE,KAAK0D,iBAAtB;AACH,SATD;AAUH;;AAEDE,UAAMrD,GAAN,EAAW;AACP,YAAItB,QAAQ,IAAZ;AACA,YAAI,KAAKmG,QAAT,EAAmB;AACfzG,YAAA,4DAAAA,CAAO7B,IAAP,CAAY,sDAAZ;AACA;AACH;AACD,aAAKsI,QAAL,GAAgB,IAAIR,IAAJ,EAAhB;AACA,aAAK7E,IAAL,CAAU,MAAV,EAAkBQ,GAAlB;AACA,YAAIA,GAAJ,EAAS;AACL5B,YAAA,4DAAAA,CAAO3B,KAAP,CAAc,wCAAuCuD,IAAIC,OAAQ,EAAjE;AACA7B,YAAA,4DAAAA,CAAOpC,KAAP,CAAagE,GAAb;AACA,iBAAKR,IAAL,CAAU,SAAV,EAAqBQ,GAArB;AACA,iBAAKvD,KAAL,GAAauD,GAAb;AACA;AACH;AACD,YAAIgE,WAAW,8CAAAe,CAAOf,QAAP,CAAgB,8CAAAe,CAAO,KAAKF,QAAZ,EAAsBG,IAAtB,CAA2B,KAAKZ,SAAhC,CAAhB,EAA4D,cAA5D,EAA4EtI,MAA5E,CAAmF,aAAnF,EAAkG;AAC7GmJ,kBAAM;AADuG,SAAlG,CAAf;AAGA7G,QAAA,4DAAAA,CAAOpC,KAAP,CAAc,kBAAiB,6CAAAE,CAAMmC,IAAN,CAAW,KAAKjB,MAAL,CAAY8F,IAAvB,CAA6B,GAA5D;AACA7B,QAAA,gDAAAA,CAAQG,KAAR,CAAc;AACVyB,mBAAON,KAAKjE,MAAMuE,KAAN,CAAYC,IAAjB,CADG;AAEV9F,oBAAQuF,KAAKjE,MAAMtB,MAAN,CAAa8F,IAAlB;AAFE,SAAd,EAGGvD,IAHH,CAGSuF,KAAD,IAAW;AACf,gBAAIC,aAAa,gDAAAC,CAASF,MAAM9H,MAAN,CAAaiI,IAAtB,EAA4B,EAACC,MAAM,IAAP,EAA5B,CAAjB;AACA,gBAAIC,mBAAmB,CAACL,MAAMjC,KAAN,CAAYoC,IAAZ,GAAmBH,MAAM9H,MAAN,CAAaiI,IAAhC,GAAuC,GAAxC,EAA6CG,OAA7C,CAAqD,CAArD,CAAvB;AACApH,YAAA,4DAAAA,CAAO/B,IAAP,CAAa,uBAAsB,6CAAAH,CAAMmC,IAAN,CAAW,KAAK4E,KAAL,CAAWkB,IAAtB,CAA4B,KAAI,6CAAAjI,CAAMM,MAAN,CAAawH,QAAb,CAAuB,MAAK,6CAAA9H,CAAMM,MAAN,CAAa2I,UAAb,CAAyB,MAAK,6CAAAjJ,CAAMM,MAAN,CAAa+I,mBAAiB,GAA9B,CAAmC,IAAhK;AACH,SAPD,EAOGE,KAPH,CAOSzF,OAAO;AACZ5B,YAAA,4DAAAA,CAAO3B,KAAP,CAAauD,IAAIC,OAAjB;AACH,SATD,EASGsB,OATH,GASa5B,IATb,CASkB,MAAM;AACpB,iBAAKH,IAAL,CAAU,SAAV;AACH,SAXD;AAaH;AAnK2C;AAAA;AAAA;;AAuKhD,SAASyE,YAAT,CAAsBhB,KAAtB,EAA6B;AACzB,WAAO,IAAI,gDAAJ,CAAY,CAACnE,OAAD,EAAUG,MAAV,KAAqB;AACpCwE,QAAA,qDAAAA,CAAOR,KAAP,EACKyC,YADL,CACkB,MADlB,EAEKtI,MAFL,CAEY,GAFZ,EAGKqF,EAHL,CAGQ,OAHR,EAGiB,UAASkD,WAAT,EAAsB;AAC/BvH,YAAA,4DAAAA,CAAOrC,KAAP,CAAa,iBAAb,EAAgC4J,WAAhC;AACH,SALL,EAMKlD,EANL,CAMQ,OANR,EAMiB,UAASzC,GAAT,EAAc;AACvBf,mBAAOe,GAAP;AACH,SARL,EASKyC,EATL,CASQ,KATR,EASe,UAASmD,MAAT,EAAiBC,MAAjB,EAAyB;AAChC,gBAAIC,QAAQD,OAAOE,KAAP,CAAa,IAAb,CAAZ;AACA,gBAAIC,WAAWF,MAAMA,MAAMG,MAAN,GAAe,CAArB,CAAf;AACA,gBAAIjC,WAAWgC,SAASE,KAAT,CAAe,IAAIC,MAAJ,CAAW,+BAAX,CAAf,EAA4D,CAA5D,CAAf;AACA,gBAAIC,UAAU,8CAAArB,CAAOf,QAAP,CAAgBA,QAAhB,EAA0BlI,MAA1B,CAAiC,GAAjC,EAAsC,CAAtC,CAAd;AACAsC,YAAA,4DAAAA,CAAOrC,KAAP,CAAc,mCAAkCqK,OAAQ,aAAxD;AACAtH,oBAAQsH,OAAR;AACH,SAhBL,EAgBO9H,GAhBP;AAiBH,KAlBM,CAAP;AAmBH,C;;;;;;ACjND;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;ACvBA,qC;;;;;;ACAA,0C;;;;;;ACAA,+B;;;;;;ACAA,mC;;;;;;ACAA,6C;;;;;;ACAA,yC;;;;;;ACAA,mC;;;;;;ACAA,mD;;;;;;ACAA,sC;;;;;;ACAA,iC;;;;;;ACAA,yC;;;;;;ACAA,mC;;;;;;ACAA,mC","file":"nmmes-backend.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"bluebird\"), require(\"chalk\"), require(\"events\"), require(\"filesize\"), require(\"fluent-ffmpeg\"), require(\"fs\"), require(\"lodash\"), require(\"lodash/cloneDeep\"), require(\"lodash/merge\"), require(\"moment\"), require(\"moment-duration-format\"), require(\"npm-query\"), require(\"path\"), require(\"query-string\"), require(\"semver\"), require(\"tracer\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"bluebird\", \"chalk\", \"events\", \"filesize\", \"fluent-ffmpeg\", \"fs\", \"lodash\", \"lodash/cloneDeep\", \"lodash/merge\", \"moment\", \"moment-duration-format\", \"npm-query\", \"path\", \"query-string\", \"semver\", \"tracer\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"nmmes-backend\"] = factory(require(\"bluebird\"), require(\"chalk\"), require(\"events\"), require(\"filesize\"), require(\"fluent-ffmpeg\"), require(\"fs\"), require(\"lodash\"), require(\"lodash/cloneDeep\"), require(\"lodash/merge\"), require(\"moment\"), require(\"moment-duration-format\"), require(\"npm-query\"), require(\"path\"), require(\"query-string\"), require(\"semver\"), require(\"tracer\"));\n\telse\n\t\troot[\"nmmes-backend\"] = factory(root[\"bluebird\"], root[\"chalk\"], root[\"events\"], root[\"filesize\"], root[\"fluent-ffmpeg\"], root[\"fs\"], root[\"lodash\"], root[\"lodash/cloneDeep\"], root[\"lodash/merge\"], root[\"moment\"], root[\"moment-duration-format\"], root[\"npm-query\"], root[\"path\"], root[\"query-string\"], root[\"semver\"], root[\"tracer\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_9__, __WEBPACK_EXTERNAL_MODULE_10__, __WEBPACK_EXTERNAL_MODULE_11__, __WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_14__, __WEBPACK_EXTERNAL_MODULE_15__, __WEBPACK_EXTERNAL_MODULE_16__, __WEBPACK_EXTERNAL_MODULE_17__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 21);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f38c13547a96dc465610","import chalk from 'chalk';\nimport tracer from 'tracer';\n\nconst options = {\n    format: [\n        \"[{{title}}] {{message}}\",\n        {\n            trace: \"[{{title}}] {{message}}\\n\\t({{method}} in {{path}}:{{line}})\",\n            debug: \"[{{title}}] {{message}} ({{method}})\",\n        }\n    ],\n    filters: [{\n        trace: chalk.magenta,\n        debug: chalk.blue,\n        info: chalk.green,\n        warn: chalk.yellow,\n        error: chalk.red\n    }],\n    dateformat: \"HH:MM:ss.L\",\n    preprocess: function(data) {\n        data.title = data.title.toUpperCase();\n    },\n    transport: function(data) {\n        if (logger.stream) {\n            logger.stream.write(data.output + \"\\n\");\n        } else {\n            console.log(data.output);\n        }\n    }\n}\n\nlet logger = tracer.colorConsole(options);\nlogger.setLevel = (level) => {\n    tracer.setLevel(level);\n};\nexport default logger;\n\n\n\n// WEBPACK FOOTER //\n// ./logger.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 2\n// module chunks = 0","'use strict';\n\nimport Logger from './logger.js';\nimport chalk from 'chalk';\nimport Promise from 'bluebird';\nimport queryString from 'query-string';\nimport cloneDeep from 'lodash/cloneDeep';\nimport merge from 'lodash/merge';\nimport semver from 'semver';\nimport {\n    NpmClient\n} from 'npm-query';\nimport {\n    EventEmitter\n} from 'events';\n\nexport default class Module extends EventEmitter {\n    provides = []\n    tolerance = 'required'\n    constructor(info, options = {}) {\n        super();\n        this.displayName = this.constructor.name;\n        if (typeof info === 'undefined') {\n            throw new Error(`Module ${this.displayName} must provide an info object.`);\n        }\n        this.info = info;\n        Object.assign(this, {\n            options\n        });\n\n        Logger.trace(`Module ${chalk.bold(this.displayName)} has been created with options:`, options);\n    }\n    run(video, force = false, cache = true) {\n        let _self = this;\n        if (this.pending) {\n            return this.pending;\n        }\n        if (video.moduleCache[createModuleQuery(this)] && video.moduleCache[createModuleQuery(this)].cache && !force) {\n            return new Promise((resolve) => {\n                Logger.debug(`Module cache hit: ${chalk.bold(_self.displayName)}'s results have been found in cache. Returning cached results.`);\n                resolve(video.moduleCache[createModuleQuery(this)].cache);\n            });\n        }\n\n        video.moduleCache[createModuleQuery(this)] = this;\n        for (let name of this.provides) {\n            video.moduleCache[createModuleQuery(module, name)] = module;\n        }\n\n        return this.execute(video, cache);\n    }\n    execute(video, cache) {\n        let _self = this;\n        return this.pending = new Promise((resolve, reject) => {\n\n            // Make params immutable\n            const Imap = video.strict && !_self.options.noStrict ? deepFreeze(cloneDeep(video.output.map)) : video.output.map;\n\n            Logger.info(`Module ${chalk.bold(_self.displayName)} has started.`);\n\n            video.emit('module-start', _self);\n            _self.emit('start');\n\n            let runModule = _self.executable(video, Imap);\n\n            runModule.then((result = {}) => {\n                video.emit('module-stop', _self);\n                _self.emit('stop');\n                Logger.trace(`Module ${chalk.bold(_self.displayName)} has finished. Results:\\n`, JSON.stringify(result));\n\n                video.output.map = merge(video.output.map, result);\n\n                if (cache)\n                    _self.cache = result;\n                delete _self.pending;\n                resolve(result);\n            }, (err) => {\n                video.emit('module-stop', _self, err);\n                _self.emit('stop', err);\n                _self.error = err;\n                if (_self.tolerance === 'required') {\n                    Logger.error(`Required module ${chalk.bold(_self.displayName)} failed: ${err.message}`);\n                    Logger.debug(`Module ${chalk.bold(_self.displayName)} error:`, err);\n                    return reject(err);\n                } else if (_self.tolerance === 'optional') {\n                    Logger.warn(`Optional module ${chalk.bold(_self.displayName)} failed: ${err.message}`);\n                    Logger.debug(`Module ${chalk.bold(_self.displayName)} error:`, err);\n                    return resolve();\n                } else {\n                    Logger.error(`Module ${chalk.bold(_self.displayName)} failed: ${err.message}`);\n                    Logger.debug(`Module ${chalk.bold(_self.displayName)} error:`, err);\n                    return reject(err);\n                }\n            });\n            let stopHandler = (err) => {\n                _self.emit('stop', err);\n                runModule.cancel();\n            };\n            video.once('stop', stopHandler);\n            _self.once('stop', () => {\n                video.removeListener('stop', stopHandler);\n            });\n        });\n    }\n}\n\nfunction createModuleQuery(module, name) {\n    return name || module.displayName + '?' + queryString.stringify(module.args);\n}\n\nfunction deepFreeze(obj, depth = 0) {\n\n    // Retrieve the property names defined on obj\n    var propNames = Object.getOwnPropertyNames(obj);\n\n    // Freeze properties before freezing self\n    propNames.forEach(function(name) {\n        var prop = obj[name];\n\n        // Freeze prop if it is an object\n        if (typeof prop == 'object' && prop !== null && depth < 6)\n            deepFreeze(prop, ++depth);\n    });\n\n    // Freeze self (no-op if already frozen)\n    return Object.freeze(obj);\n}\n\nexport function checkForUpdates(modules) {\n    let client = new NpmClient();\n\n    // Convert module array to object\n    let moduleMap = modules.reduce((obj, module) => {\n        obj[module.info.name] = module;\n        return obj;\n    }, {});\n\n    let queries = modules.reduce((obj, module) => {\n        obj[module.info.name] = Promise.resolve(client.getModule(module.info.name)).reflect();\n        return obj;\n    }, {});\n\n    Promise.props(queries).then((results) => {\n        for (let [name, data] of Object.entries(results)) {\n            if (data.isFulfilled()) {\n                data = data.value();\n                const latest = data['dist-tags'].latest;\n                const current = moduleMap[name].info.version;\n                if (semver.gt(latest, current)) {\n                    Logger.warn(`Newer version of ${name}@${latest} available (current: ${current})`);\n                }\n            } else {\n                data = data.reason();\n                Logger.trace(`Could not check for a new version of ${chalk.bold(name)}. Error:`, data.message);\n            }\n        }\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./module.js","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 4\n// module chunks = 0","import Promise from 'bluebird';\nimport Logger from './logger.js';\nPromise.config({\n    // Enable warnings\n    warnings: true,\n    // Enable long stack traces\n    longStackTraces: true,\n    // Enable cancellation\n    cancellation: true,\n    // Enable monitoring\n    monitoring: false\n});\n\nprocess.on(\"unhandledRejection\", function(reason) {\n    Logger.error('UNHANDLED ERROR:', reason);\n});\n\nimport Module from './module.js';\nimport Video from './video.js';\nexport {Module, Video, Logger};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","'use strict';\n\nimport chalk from 'chalk';\nimport EventEmitter from 'events';\nimport ffmpeg from 'fluent-ffmpeg';\nimport moment from 'moment';\nrequire(\"moment-duration-format\");\nimport Promise from 'bluebird';\nimport fs from 'fs';\nimport fileSize from 'filesize';\nimport {\n    checkForUpdates\n} from './module.js';\nimport {\n    merge\n} from 'lodash';\nimport Path from 'path';\n\nconst stat = Promise.promisify(fs.stat);\n\nimport Logger from './logger.js';\n\nexport default class Video extends EventEmitter {\n    curretModuleIndex = 0\n    moduleCache = {}\n    constructor(options) {\n        Logger.debug(`Creating ${chalk.bold(Path.basename(options.input.path))}.`);\n\n        if (!options.input.path)\n            throw new Error('options.input.path must be provided.');\n        if (!options.output.path)\n            throw new Error('options.output.path must be provided.');\n\n        super();\n\n        merge(this, {\n            strict: true,\n            input: { ...Path.parse(options.input.path),\n                map: {\n                    streams: {},\n                    format: {}\n                }\n            },\n            output: { ...Path.parse(options.output.path),\n                map: {\n                    streams: {},\n                    format: {}\n                }\n            }\n        }, options);\n\n        // checkForUpdates(this.modules);\n\n        Logger.trace('Video created:\\n', this);\n    }\n    initialized() {\n        let _self = this;\n        return new Promise((resolve, reject) => {\n            Logger.trace('Generating metadata for input...');\n            ffmpeg.ffprobe(_self.input.path, function(err, metadata) {\n                if (err)\n                    return reject(err);\n\n                // Lets do some metadata manipulation, I want the streams array as an\n                // object\n                metadata.streams = metadata.streams.reduce((obj, stream) => {\n                    stream.input = 0;\n                    obj[stream.index] = stream;\n                    return obj;\n                }, {});\n\n                _self.input.metadata = {\n                    0: metadata\n                };\n\n                const streams = Object.values(metadata.streams);\n                for (let pos in streams) {\n                    const stream = streams[pos];\n\n                    _self.output.map.streams[stream.index] = {\n                        map: `${stream.input}:${stream.index}`,\n                        ['metadata:s:' + pos]: [],\n                        ['disposition:' + pos]: []\n                    };\n                }\n\n                if (isNaN(metadata.format.duration)) {\n                    Logger.trace('Invalid duration:', chalk.bold(metadata.format.duration));\n                    Logger.debug(`Duration invalid, attempting to calculate manually...`);\n                    calcDuration(_self.input.path).then((duration) => {\n                        Logger.debug(`Duration calculated to ${duration} second(s).`);\n                        metadata.format.duration = duration;\n                        resolve();\n                    }, reject);\n                } else {\n                    resolve();\n                }\n            });\n        });\n    }\n\n    start() {\n        let _self = this;\n        this.emit('start');\n        Logger.info(`Started processing ${chalk.bold(this.input.base)}.`);\n        this.startTime = new Date();\n\n        return new Promise((resolve, reject) => {\n            // Run module init\n            Promise\n                .all(this.modules.reduce((array, module) => {\n                    if (!module.init)\n                        return array;\n                    array.push(new Promise((resolve, reject) => {\n                        module.init(_self).then(resolve, (err) => {\n                            Logger.error(`Module ${chalk.bold(module.displayName)} initialization failed: ${err.message}`);\n                            Logger.debug('Error:', err);\n                            reject(new Error('Module initialization failed.'));\n                        });\n                    }));\n                    return array;\n                }, []))\n                .then(this.initialized.bind(this))\n                .then(resolve)\n                .return(0)\n                .then(this.runModule.bind(this), (err) => {\n                    this._stop(err);\n                    reject(err);\n                });\n        });\n    }\n\n    runModule(number = this.curretModuleIndex) {\n        if (!this.modules[number]) {\n            this._stop();\n            return;\n        }\n        if (this.stopTime)\n            return;\n        const moduleName = this.modules[number].displayName;\n        Logger.trace(`Running module ${chalk.bold(moduleName)} [${chalk.bold(number)}].`);\n        this.modules[number].run(this).then(() => {\n            this.runModule(++number);\n        }, (err) => {\n            if (this.modules[number].tolerance === 'required') {\n                Logger.debug('Error:', err);\n                return this._stop(new Error('Module execution failed.'));\n            }\n\n            this.runModule(++this.curretModuleIndex);\n        });\n    }\n\n    _stop(err) {\n        let _self = this;\n        if (this.stopTime) {\n            Logger.warn('Attempted to stop a video which has already stopped.')\n            return;\n        }\n        this.stopTime = new Date();\n        this.emit('stop', err);\n        if (err) {\n            Logger.error(`Video stopped processing with error: ${err.message}`);\n            Logger.debug(err);\n            this.emit('stopped', err);\n            this.error = err;\n            return;\n        }\n        let duration = moment.duration(moment(this.stopTime).diff(this.startTime), 'milliseconds').format('h:mm:ss.SSS', {\n            trim: false\n        });\n        Logger.debug(`File output to ${chalk.bold(this.output.path)}.`);\n        Promise.props({\n            input: stat(_self.input.path),\n            output: stat(_self.output.path),\n        }).then((stats) => {\n            let outputSize = fileSize(stats.output.size, {bits: true});\n            let reductionPercent = (stats.input.size / stats.output.size * 100).toFixed(2);\n            Logger.info(`Finished processing ${chalk.bold(this.input.base)} [${chalk.yellow(duration)}] [${chalk.yellow(outputSize)}] [${chalk.yellow(reductionPercent+'%')}].`);\n        }).catch(err => {\n            Logger.error(err.message);\n        }).reflect().then(() => {\n            this.emit('stopped');\n        });\n\n    }\n    stop = this._stop;\n}\n\nfunction calcDuration(input) {\n    return new Promise((resolve, reject) => {\n        ffmpeg(input)\n            .outputFormat('null')\n            .output('-')\n            .on('start', function(commandLine) {\n                Logger.trace('[FFMPEG] Query:', commandLine);\n            })\n            .on('error', function(err) {\n                reject(err);\n            })\n            .on('end', function(stdout, stderr) {\n                let lines = stderr.split('\\n');\n                let lastTime = lines[lines.length - 3];\n                let duration = lastTime.match(new RegExp('time=(([0-9]|\\:|\\.)+) bitrate'))[1];\n                let seconds = moment.duration(duration).format(\"s\", 6);\n                Logger.trace(`Duration manually calculated to ${seconds} second(s).`);\n                resolve(seconds);\n            }).run();\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./video.js","module.exports = function(originalModule) {\r\n\tif(!originalModule.webpackPolyfill) {\r\n\t\tvar module = Object.create(originalModule);\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"exports\", {\r\n\t\t\tenumerable: true,\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/webpack/buildin/harmony-module.js\n// module id = 7\n// module chunks = 0","module.exports = require(\"filesize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"filesize\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"fluent-ffmpeg\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fluent-ffmpeg\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash/cloneDeep\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/cloneDeep\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash/merge\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/merge\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"moment-duration-format\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment-duration-format\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"npm-query\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"npm-query\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"query-string\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"query-string\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"semver\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"semver\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"tracer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"tracer\"\n// module id = 20\n// module chunks = 0"],"sourceRoot":""}